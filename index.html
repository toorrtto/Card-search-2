<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>ã‚«ãƒ¼ãƒ‰æ¤œç´¢ã€€v2</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚¢ãƒ—ãƒª</title>
<style>
body { font-family:sans-serif; padding:20px; background:#f0f0f0; }
input, select, button { margin:5px; padding:8px; font-size:16px; }
input, select { width:180px; }
button { cursor:pointer; padding:8px 12px; }

#cardList { display:flex; flex-wrap:wrap; gap:10px; margin-top:20px; }

.card {
  width:160px;
  height:280px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
  padding:10px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  cursor:pointer;
  color:#fff;
  user-select:none;
}

.rarity {
  font-weight:bold;
  font-size:14px;
}

.modal {
  display:none;
  position:fixed;
  z-index:10;
  left:0; top:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  justify-content:center;
  align-items:center;
}
.modal-content {
  background:#fff;
  padding:20px;
  border-radius:8px;
  max-width:400px;
  position:relative;
  color:#000;
}
.close { position:absolute; top:5px; right:10px; cursor:pointer; }

/* æ–‡æ˜ã‚«ãƒ©ãƒ¼ */
.fire { background:#FF6B6B; }
.water { background:#4D96FF; }
.nature { background:#4CAF50; }
.dark { background:#6E44FF; }
.light { background:#FFD93D; color:#000; }
.multi { background:#FF6BD6; }
.zero { background:#9E9E9E; }

#adminStatus { font-weight:bold; color:#d32f2f; }
#loading { display:none; margin-top:10px; }
</style>
</head>
<body>

<h1>ã‚«ãƒ¼ãƒ‰ç®¡ç†ã‚¢ãƒ—ãƒª</h1>

<button onclick="enterAdminMode()">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</button>
<button onclick="exitAdminMode()">ç®¡ç†è€…ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
<span id="adminStatus"></span>

<!-- ç®¡ç†è€…å°‚ç”¨ -->
<div id="adminOnlyArea" style="display:none;">
<h2>ã‚«ãƒ¼ãƒ‰è¿½åŠ </h2>
<input id="cardName" placeholder="ã‚«ãƒ¼ãƒ‰å">
<input id="cardTribe" placeholder="ç¨®æ—">
<select id="cardRarity">
<option value="">--ãƒ¬ã‚¢åº¦--</option>
<option value="LGR">LGR</option>
<option value="SR">SR</option>
<option value="R">R</option>
<option value="U">U</option>
<option value="C">C</option>
</select>

<select id="cardType">
<option value="">--ç¨®é¡--</option>
<option value="ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼</option>
<option value="é€²åŒ–ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼">é€²åŒ–ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼</option>
<option value="REVOãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼">REVOãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼</option>
<option value="ã‚¹ãƒšãƒ«">ã‚¹ãƒšãƒ«</option>
<option value="ãƒãƒ†ãƒªã‚¢ã‚¢ãƒ«">ãƒãƒ†ãƒªã‚¢ã‚¢ãƒ«</option>
<option value="ãƒãƒ†ãƒªã‚¢ãƒ«ã‚®ã‚¢">ãƒãƒ†ãƒªã‚¢ãƒ«ã‚®ã‚¢</option>
</select>

<select id="cardCivilization">
<option value="">--æ–‡æ˜--</option>
<option value="ç«">ç«</option>
<option value="æ°´">æ°´</option>
<option value="è‡ªç„¶">è‡ªç„¶</option>
<option value="é—‡">é—‡</option>
<option value="å…‰">å…‰</option>
<option value="å¤šè‰²">å¤šè‰²</option>
<option value="ã‚¼ãƒ­">ã‚¼ãƒ­</option>
</select>

<input id="cardCost" type="number" placeholder="ã‚³ã‚¹ãƒˆ">
<input id="cardEffect" placeholder="åŠ¹æœ">
<button onclick="addCard()">è¿½åŠ </button>
</div>

<h2>ã‚«ãƒ¼ãƒ‰æ¤œç´¢</h2>
<input id="searchName" placeholder="åå‰">
<input id="searchTribe" placeholder="ç¨®æ—">
<select id="searchRarity">
<option value="">--ãƒ¬ã‚¢åº¦--</option>
<option value="LGR">LGR</option>
<option value="SR">SR</option>
<option value="R">R</option>
<option value="U">U</option>
<option value="C">C</option>
</select>

<input id="searchCost" type="number" placeholder="ã‚³ã‚¹ãƒˆ">
<input id="searchEffect" placeholder="åŠ¹æœ">

<button onclick="searchCard()">æ¤œç´¢</button>
<button onclick="resetSearch()">ãƒªã‚»ãƒƒãƒˆ</button>

<div id="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
<div id="cardList"></div>

<div id="modal" class="modal">
<div class="modal-content">
<span class="close" onclick="closeModal()">&times;</span>
<h3 id="modalName"></h3>
<div id="modalRarity"></div>
<div id="modalTribe"></div>
<div id="modalType"></div>
<div id="modalCivilization"></div>
<div id="modalCost"></div>
<p id="modalEffect"></p>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"YOUR_API_KEY",
  authDomain:"card-search-7c28e.firebaseapp.com",
  projectId:"card-search-7c28e"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

const ADMIN_PASSWORD="114514810";
let isAdminMode=false;

function enterAdminMode(){
  const pass=prompt("ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›");
  if(pass===ADMIN_PASSWORD){
    isAdminMode=true;
    adminStatus.innerText="ğŸ›¡ ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ä¸­";
    adminOnlyArea.style.display="block";
  }else alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
}
function exitAdminMode(){
  isAdminMode=false;
  adminStatus.innerText="";
  adminOnlyArea.style.display="none";
}

async function addCard(){
  const name=cardName.value.trim();
  if(!name) return;

  await db.collection("cards").add({
    name,
    tribe:cardTribe.value,
    rarity:cardRarity.value,
    type:cardType.value,
    civilization:cardCivilization.value,
    cost:Number(cardCost.value),
    effect:cardEffect.value,
    created_at:firebase.firestore.FieldValue.serverTimestamp()
  });

  document.querySelectorAll("#adminOnlyArea input, #adminOnlyArea select")
    .forEach(e=>e.value="");

  resetScroll();
}

let lastVisible=null;
let isFetching=false;
const pageSize=30;

async function fetchCards(){
  if(isFetching) return;
  isFetching=true;
  loading.style.display="block";

  let query=db.collection("cards")
    .orderBy("created_at","desc")
    .limit(pageSize);

  if(lastVisible) query=query.startAfter(lastVisible);

  const snapshot=await query.get();
  if(snapshot.empty){ isFetching=false; loading.style.display="none"; return; }

  lastVisible=snapshot.docs[snapshot.docs.length-1];
  display(snapshot.docs);

  isFetching=false;
  loading.style.display="none";
}

function resetScroll(){
  lastVisible=null;
  cardList.innerHTML="";
  fetchCards();
}

function display(docs){
  docs.forEach(doc=>{
    const d=doc.data();
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <div class="rarity">${d.rarity||""}</div>
      <strong>${d.name}</strong>
      <div>${d.tribe||"-"}</div>
      <div>ã‚³ã‚¹ãƒˆ:${d.cost||"-"}</div>
    `;

    let timer;
    div.addEventListener("touchstart",()=>{
      timer=setTimeout(()=>{
        if(isAdminMode && confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
          db.collection("cards").doc(doc.id).delete().then(resetScroll);
        }
      },800);
    });
    div.addEventListener("touchend",()=>clearTimeout(timer));
    div.addEventListener("click",()=>openModal(d));
    cardList.appendChild(div);
  });
}

async function searchCard(){
  const snapshot=await db.collection("cards").get();
  const filtered=snapshot.docs.filter(doc=>{
    const d=doc.data();
    return (!searchName.value||d.name.includes(searchName.value))
      && (!searchTribe.value||d.tribe.includes(searchTribe.value))
      && (!searchRarity.value||d.rarity===searchRarity.value)
      && (!searchEffect.value||d.effect.includes(searchEffect.value))
      && (!searchCost.value||d.cost==searchCost.value);
  });
  cardList.innerHTML="";
  display(filtered);
}

function resetSearch(){
  document.querySelectorAll("#searchName,#searchTribe,#searchRarity,#searchCost,#searchEffect")
    .forEach(e=>e.value="");
  resetScroll();
}

function openModal(d){
  modalName.innerText=d.name;
  modalRarity.innerText="ãƒ¬ã‚¢åº¦: "+(d.rarity||"-");
  modalTribe.innerText="ç¨®æ—: "+(d.tribe||"-");
  modalType.innerText="ã‚¿ã‚¤ãƒ—: "+(d.type||"-");
  modalCivilization.innerText="æ–‡æ˜: "+(d.civilization||"-");
  modalCost.innerText="ã‚³ã‚¹ãƒˆ: "+(d.cost||"-");
  modalEffect.innerText=d.effect||"";
  modal.style.display="flex";
}
function closeModal(){ modal.style.display="none"; }

window.addEventListener("scroll",()=>{
  if(window.innerHeight+window.scrollY>=document.body.offsetHeight-50){
    fetchCards();
  }
});

fetchCards();
</script>
</body>
</html>
    
  </body>
  
</html>
